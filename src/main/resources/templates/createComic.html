<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <link rel="icon" type="image/png" href="/img/logo.png">
   <title>COMS.com</title>

   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
   <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Condensed" rel="stylesheet">
   <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
   <style>
      /* body{
      background:  url("./img/background.jpg");
      background-repeat: no-repeat;
      background-size: 100%;
      } */
      body, html {
      height: 100%;
      margin: 0;
         width: 100%;
      /* The image used */
         margin: 0;

      /* background-image: url("./img/troll.jpg"); */
      /* Full height */
      /* Center and scale the image nicely */

      /* color: #71eeb8; */
      }
      nav {background-color: #000000; border:none;font-family:'Open Sans', sans-serif;position:relative;}
      .navbar-header{padding-right:50px}
      .navbar-brand{color:#71eeb8}
      .navbar-brand:hover{color:#88AA99;}
      .nav-item a{color:#71eeb8}
      .nav-item a:hover{text-decoration: none;color:#88AA99}
      .nav-item{margin-right:15px}
      .nav-item .dropdown-menu{background-color:#2B2B2B}

      #searchBox input[type=search]{width:15px;padding-left:5px;color:transparent;cursor:pointer;}
      #searchBox input[type=search]:hover{}
      #searchBox input[type=search]:focus{width:250px;padding-left:40px;color:#71eeb8;background-color:#000;cursor:auto;border-radius: 5px}
      #searchBox-2 input:-moz-placeholder {color: transparent;}
      #searchBox-2 input::-webkit-input-placeholder{color: transparent;}
      #searchBox input[type=search]{background:url("/img/searchTransparent.png") no-repeat 9px center;width:35px;border: none;background-size:20px 20px;padding:5px}
      input {outline: none;}
      input[type=search] {-webkit-appearance: textfield;-webkit-box-sizing: content-box;font-family: inherit;font-size: 100%;}
      input::-webkit-search-decoration, input::-webkit-search-cancel-button {display: none; }

      .container{margin-top:75px;margin-right:10px;margin-left:-15px}

      input{margin-top:12px}

      form textarea{width:80%;resize:none;height:50px}
      form textarea:focus{outline:none}
      form button{position:absolute;width:inherit;height:50px}

      /* The container
      <div>
      - needed to position the dropdown content */
      .dropdown {position: relative;display: inline-block;}
      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {display: none;position: absolute;background-color: white;box-shadow: 0px 8px 16px 2px rgba(0,0,0,0);z-index: 1;}
      /* Links inside the dropdown */
      .dropdown-content a {color: black;padding: 12px 16px;text-decoration: none;display: block;}
      /* Change color of dropdown links on hover */
      .dropdown-content a:hover {background-color: #ddd;}
      /* Show the dropdown menu on hover */
      .dropdown:hover .dropdown-content {display: block;}
      /* Change the background color of the dropdown button when the dropdown content is shown */
      .dropdown:hover .dropbtn {background-color: #17a2b8;}
      .tools::after {display:none;}
      label{background-color: white;margin-top:10px;margin-right:5px}

      input[type=number]{width: 27px;height:21px;margin-right:5px}
      input[type=color]{width: 20px;height:20px;margin-right:5px}
      select{height:22px;margin-top:12px;margin-right:5px}

      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {-webkit-appearance: none;margin: 0; /* <-- Apparently some margin are still there even though it's hidden */}
      input::-webkit-inner-spin-button {-webkit-appearance: none;margin: 0; /* <-- Apparently some margin are still there even though it's hidden */}
      input[type=number] {-moz-appearance:textfield; /* Firefox */}

      .dropdown-menu{
        min-width: 100px !important;
      }
      .row{
        width: 1500px !important;
      }
      #mydiv{
        background-color: rgb(255, 255, 255);
      }

      .btn-info{background-color:lightskyblue}
   </style>
</head>

<nav class="navbar navbar-toggleable-xs navbar-expand-md fixed-top">
   <div class="navbar-collapse collapse">
      <div class="navbar-header">
         <a class="navbar-brand" th:href="@{/home}">
            <img src="/img/logo.png" width="100px" height="35px">
         </a>
      </div>
      <ul class="navbar-nav mr-auto">
         <li class="nav-item active" style="margin-top:8px">
            <a th:href="@{/myList}">My List</a>
         </li>
         <li class="nav-item active" style="margin-top:8px">
            <a th:href="@{/subscriptions}">Subscriptions</a>
         </li>
         <li class="nav-item active dropdown" style="margin-left:-3px">
            <a class="nav-link dropdown-toggle" id="genreDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" href="#">
               Genre
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="genreDropdown">
               <a class="dropdown-item" th:href="@{/comic/Foreign}">Foreign</a>
               <a class="dropdown-item" th:href="@{/comic/Funny}">Funny</a>
               <a class="dropdown-item" th:href="@{/comic/Horror}">Horror</a>
               <a class="dropdown-item" th:href="@{/comic/Kids}">Kids</a>
               <a class="dropdown-item" th:href="@{/comic/Mystery}">Mystery</a>
               <a class="dropdown-item" th:href="@{/comic/Romance}">Romance</a>
            </div>
         </li>
      </ul>
   </div>
   <div class="navbar-collapse collapse">
      <ul class="navbar-nav ml-auto">
         <li class="nav-item" style="margin-top:-7px">
            <form id="searchBox" action="/search/keyword" method = "get">
               <input name = "searchWord" type="search">
            </form>
         </li>
         <li class="nav-item active" style="margin-top:8px" th:if="${isLoggedIn}">
            <a th:href="@{/series/mySeries}"> My Creations</a>
         </li>
         <li class="nav-item active" style="margin-top:8px" th:if="${isLoggedIn}">
         <li class="nav-item dropdown" th:if="${isLoggedIn}">
            <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" href="#">
               <span class="fa fa-user-circle-o" aria-hidden="true"></span>
               <span th:text=" ${username}" style="margin-left:1px"> </span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
               <a class="dropdown-item" th:href="@{/profile/inbox}">Inbox</a>
               <a class="dropdown-item" th:href="@{/profile/self}">My Profile</a>
               <div class="dropdown-divider"></div>
               <a class="dropdown-item" th:href="@{/logout}">Log Out</a>
            </div>
         </li>
         <li class="nav-item active" style="margin-top:13px" th:if="${notLoggedIn}">
            <a th:href="@{/}"><span class="fa fa-sign-in"></span> Login</a>
         </li>
      </ul>
   </div>
</nav>

<body>
   <div class="container">

      <!-- TOP TOOLBAR -->
      <div class="row" style="margin-top:7px">
         <div class="col">
            <div class="btn-toolbar" role="toolbar">
               <!-- UNDO REDO GROUP UNGROUP =-->
               <div class="btn-group mr-2" role="group" style="margin-left:55px">
                  <button type="button" class="btn btn-info" onclick="undo()" title="Undo">
                     <img src="/img/undo.png" alt="Undo" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="redo()" title="Redo">
                     <img src="/img/redo.png" alt="Redo" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="deleteObject()" title="Delete">
                     <img src="/img/trash.png" alt="Delete" height="20" width = "20">
                  </button>
                  <button  type="button" class="btn btn-info" onclick="group()" title="Group">
                     <img src="/img/group.png" alt="Group" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="ungroup()" title="Ungroup">
                     <img src="/img/ungroup.png" alt="Ungroup" height="20" width = "20">
                  </button>
               </div>

               <!-- ZOOMING BUTTONS -->
               <div class="btn-group mr-2" role="group" style="margin-left:150px">
                  <button  type="button" class="btn btn-info" onclick="zoomin()" title="Zoom In">
                     <img src="/img/zoom-in.png" alt="Zoom In" height="20" width = "20">
                  </button>
                  <button  type="button" class="btn btn-info" onclick="zoomout()" title="Zoom Out">
                     <img src="/img/zoom-out.png" alt="Zoom Out" height="20" width = "20">
                  </button>
                  <button  type="button" class="btn btn-info" onclick="recenter()" title="Re-center">
                     <img src="/img/center.png" alt="Center" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="copy()" title="Copy">
                     <img src="/img/copy.png" alt="Copy" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="cut()" title="Cut">
                     <img src="/img/cut.png" alt="Cut" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="paste()" title="Paste">
                     <img src="/img/paste.png" alt="Paste" height="20" width = "20">
                  </button>
               </div>

               <!-- CLEAR SAVE EXPORT -->
               <div class="btn-group mr-2" role="group" style="margin-left:150px">
                  <button id="clear-canvas" class="btn btn-info" title="Clear Canvas">
                     <img src="/img/clear.png" alt="Clear" height="20" width = "20">
                  </button>
                  <button id="save-canvas" type="button" class="btn btn-info" title="Save">
                     <img src="/img/save.png" alt="Save" height="20" width = "20">
                  </button>
                  <div class="btn-group" role="group">
                     <button class="btn btn-info dropdown-toggle tools" type="button" id="exportButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Export">
                        <img src="/img/download.png" alt="shapes" height="20" width="20">
                     </button>
                     <div class="dropdown-menu" aria-labelledby="exportButton">
                        <button type="button" class="btn btn-info" onclick="downloadImage()" title="Export as Image">
                           <img src="/img/imagedownload.png" alt="Export as an Image" height="20" width = "20">
                        </button>
                        <button type="button" class="btn btn-info" onclick="downloadJSON()" title="Export as JSON">
                           <img src="/img/json.png" alt="Export as a JSON" height="15" width="20">
                        </button>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="row" style="margin-left:50px;margin-top:3px;padding-right:5px">
         <select id="drawing-mode-selector">
            <option>Pencil</option>
            <option>Circle</option>
            <option>Spray</option>
            <option>Poka-dots</option>
            <option>hline</option>
            <option>vline</option>
            <option>square</option>
            <option>diamond</option>
         </select>
         <input type="color" value="#000000" id="drawing-color">

         <label for="drawing-line-width">Line Width</label>
         <input type="number" min="1" max="500" value="15" id="drawing-line-width">
         <!-- SHADOW -->
         <label for="drawing-shadow-color">Shadow</label>
         <input type="color" value="#000000" id="drawing-shadow-color">
         <label for="drawing-shadow-width">Shadow Width</label>
         <input type="number" min="0" max="500" value="0" id="drawing-shadow-width">
         <label for="drawing-shadow-offset">Shadow Offset</label>
         <input type="number" min="0" max="500" size="4" value="30" id="drawing-shadow-offset">

         <select id="fonts" onchange="fontchange()">
            <option value="Arial">Arial</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Times">Times</option>
            <option value="Impact">Impact</option>
            <option value="Courier New">Courier New</option>
            <option value="Courier">Courier</option>
            <option value="Verdana">Verdana</option>
            <option value="Georgia">Georgia</option>
            <option value="Palatino">Palatino</option>
            <option value="Garamond">Garamond</option>
            <option value="Bookman">Bookman</option>
            <option value="Comic Sans MS">Comic Sans MS</option>
            <option value="Trebuchet MS">Trebuchet MS</option>
            <option value="Arial Black">Arial Black</option>
         </select>
         <label for="font-size">Font Size</label>
         <input type="number"min="0" max="500" value="30" id="font-size" width="20px" height="10px">
         <!-- OUTLINE COLOR -->
         <label for="stroke">Outline</label>
         <input type="color" id="stroke" name="stroke" value="#000000" onchange="changeStroke()">
         <!-- FILL COLOR -->
         <label for="fill">Fill</label>
         <input type="color" id="fill" name="fill" value="#ffffff" onchange="changeFill()">

         <!-- OPACITY -->
         <label for="opacity">Opacity</label>
         <input type="number" id="opacity" min="0" max="100" size="4" value="100" onchange="changeOpacity()">
      </div>


      <div class="row">
         <!-- SIDE TOOLBAR -->
         <div class="col-md-auto">
            <div class="btn-group-vertical" style="float:left">

               <!-- SELECTION BUTTON -->
               <button class="btn btn-info" id="drawing-mode" title="Selection">
                  <img src="/img/select.png" alt="shapes" height="20" width="20">
               </button>

               <!-- DRAWING BUTTON -->
               <button class="btn btn-info" onclick="enterDrawingMode()" title="Draw">
                  <img src="/img/drawing.png" alt="shapes" height="20" width="20">
               </button>

               <!-- SHAPES BUTTONS -->
               <div class="btn-group" role="group">
                  <button class="btn btn-info dropdown-toggle tools" type="button" id="shapesButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Shapes">
                     <img src="/img/shapes.png" alt="shapes" height="20" width="20">
                  </button>
                  <div class="dropdown-menu" aria-labelledby="shapesButton">
                     <button type="button" class="btn btn-info" onclick="drawRec();exitDrawingMode()" id="rect" height="20" width = "20">
                        <img src="/img/rectangle.png" alt="Rectangle" height="15" width="20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="drawSquare();exitDrawingMode()">
                        <img src="/img/square.png" alt="Square" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="drawTriangle();exitDrawingMode()">
                        <img src="/img/triangle.png" alt="Triangle" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="drawCircle();exitDrawingMode()">
                        <img src="/img/ellipse.png" alt="Circle" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="drawLine();exitDrawingMode()">
                        <img src="/img/line.png" alt="Line" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="arrow();exitDrawingMode()">
                        <img src="/img/arrow.png" alt="Arrow" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="chat();exitDrawingMode()">
                        <img src="/img/chat.png" alt="Talk Bubble" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="thought();exitDrawingMode()">
                        <img src="/img/thought.png" alt="Thought Bubble" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="scream();exitDrawingMode()">
                        <img src="/img/scream.png" alt="Scream Bubble" height="20" width = "20">
                     </button>
                     <button type="button" class="btn btn-info" onclick="action();exitDrawingMode()">
                        <img src="/img/action.png" alt="Action Bubble" height="20" width = "20">
                     </button>
                  </div>
               </div>

               <!-- ADD TEXTBOX -->
               <button class="btn btn-info" onclick="addTextbox();exitDrawingMode()" title="Add Text">
                  <img src="/img/text.png" alt="Text" height="20" width="20">
               </button>

               <!-- UPLOAD BUTTONS -->
               <div class="btn-group" role="group">
                  <button class="btn btn-info dropdown-toggle tools" type="button" id="uploadButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Upload">
                     <img src="/img/image.png" alt="upload" height="20" width="20">
                  </button>
                  <div class="dropdown-menu" aria-labelledby="uploadButton">
                     <button type="button" class="btn btn-info" onclick="document.getElementById('imgLoader').click();;exitDrawingMode()" title="Upload Image">
                        <img src="/img/imagedownload.png" alt="Upload Image" height="20" width = "20">
                     </button>
                     <input type='file' id="imgLoader" style="display: none;"/>
                     <button type="button" class="btn btn-info" onclick="document.getElementById('jsonLoader').click();;exitDrawingMode()" title="Upload JSON">
                        <img src="/img/json.png" alt="Upload Json" height="20" width = "20">
                     </button>
                     <input type='file' id="jsonLoader" style="display: none;"/>
                  </div>
               </div>

               <!-- BACKGROUND BUTTONS -->
               <button type="button" class="btn btn-info" onclick="document.getElementById('backgroundImage').click();;exitDrawingMode()" title="Add Background">
                  <img src="/img/add.png" alt="Upload Download Image" height="20" width = "20">
               </button>
               <input type='file' id="backgroundImage" style="display: none;"/>
               <button type="button" class="btn btn-info" onclick="removeBackground();exitDrawingMode()" title="Remove Background">
                  <img src="/img/remove.png" alt="Remove Background" height="20" width = "20">
               </button>

               <!-- LAYER BUTTONS -->
               <button type="button" class="btn btn-info" onclick="sendToBack();exitDrawingMode()" title="Send To Back" >
                  <img src="/img/back.png" alt="Send To Back" height="15" width="20">
               </button>
               <button type="button" class="btn btn-info" onclick="back();exitDrawingMode()" title="Send Back One" >
                  <img src="/img/backward.png" alt="Send Back One" height="15" width="20">
               </button>
               <button type="button" class="btn btn-info" onclick="front();exitDrawingMode()" title="Send Forward One" >
                  <img src="/img/forward.png" alt="Send Front One" height="15" width="20">
               </button>
               <button type="button" class="btn btn-info" onclick="bringToFront();exitDrawingMode()" title="Send To Front" style="-moz-transform: scale(-1, -1);-o-transform: scale(-1, -1);-webkit-transform: scale(-1, -1);transform: scale(-1, -1);">
                  <img src="/img/back.png" alt="Send To Front" height="15" width = "20">
               </button>

            </div>

            <!-- CANVAS -->
            <div id="mydiv" tabindex="0" style="margin-left:3px;float:right">
               <canvas id="canvas" width="1200" height="600" style="border:1px solid #000000;"></canvas>
            </div>
         </div>

      </div>

      <!-- PAGINATION -->
      <div class="row" style="text-align: center;margin-left:45%">
         <div class="col">
            <ul class="pagination" th:if="${panelList!=null}">
               <li class="page-item" th:if="${panelList.size() > 1}">
                  <a class="page-link"th:data-thing="${currentPanel.getId()}" onclick="deletePanel(this.getAttribute('data-thing'));");>
                     Delete Panel
                  </a>
               </li>
               <li class="page-item" th:each="panel,iter: ${panelList}">
                  <a class="page-link" th:text="${iter.index+1}" th:data-thing="${panel.getId()}" onclick="form_edit_panel(this.getAttribute('data-thing'));"></a>
               </li>
               <li class="page-item">
                  <a class="page-link" onclick="addPanelSubmit()">
                     Add Panel
                  </a>
               </li>
            </ul>
         </div>
      </div>


      <script>
         var sel = document.getElementById('fonts');
         console.log( sel.value );
         function fontchange(){
             console.log("value has been changed");
             var x = document.getElementById("fonts").value;
             console.log(x);
             console.log(typeof(x));
         }
      </script>


<!--          <form action = "/series/editComic" method = "post" id = "editPanelForm"> -->
     <form hidden action = "/comic/edit" method = "post" id = "editPanelForm">
         <input name = "editPanelId" id = "editPanelId">
      </form>
      <form id="addPanelForm" hidden action = "/addPanel", method = "GET">
         <button type="submit"></button>
      </form>
      <form id = "deletePanelForm" action = "/panel/delete" method = "get">
         <input hidden id = "deletePanelId" name = "panelId">
      </form>


      <script src="/js/canvas-toBlob.js"></script>
      <script type="text/javascript" src = "/js/FileSaver.js"></script>
      <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.7.0/fabric.min.js"></script>-->
         <script type="text/javascript" src = "/js/fabric.js"></script>
         <script type="text/javascript" src = "/js/canvasDrawing.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
          $(document).ready(function() {
              $("#save-canvas").click(function() {
                 console.log(canvas.toJSON());
                  console.log(canvas.toDataURL);
                  var requestBody = {
                      body: JSON.stringify(canvas.toJSON()),
                      image: canvas.toDataURL()
                  }
                  $.ajax({
                      type:'POST',
                      url :"/savePanel",
                      data: requestBody,
                      success: [function(data) {
                          console.log(data);
                          //$("body").html(data);
                     }],
                      error:function(exception){alert('Exeption:'+exception);}
                  });
              });
          });
         function form_edit_panel(panelId) {
             document.getElementById("editPanelId").value = panelId
             document.getElementById("editPanelForm").submit();
         }

         function addPanelSubmit(){
            document.getElementById("addPanelForm").submit();
         }
          function deletePanel(panelId)
          {
             document.getElementById("deletePanelId").value = panelId;
             document.getElementById("deletePanelForm").submit();

          }
      </script>
      <script th:inline="javascript">
         /*<![CDATA[*/

         console.log(/*[[${currentPanel}]]*/ null);
         if(/*[[${currentPanel}]]*/ null != null)
         {
             var json = /*[[${currentPanel.getFabricJSON()}]]*/ null ;
             loading(json);
             // canvas.loadFromJSON(json, function() {
             //     canvas.renderAll();
             // },function(o,object){
             //     console.log(o,object)
             // })
         }


         /*]]>*/
      </script>
   </div>
</body>
</html>
