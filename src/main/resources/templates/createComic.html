<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <title>COMS.com</title>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
   <script src="https://unpkg.com/bootstrap-table@1.13.5/dist/bootstrap-table.min.js"></script>
   <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.0/bootstrap.min.js"></script>
   <style>
      /* body{
      background:  url("./img/background.jpg");
      background-repeat: no-repeat;
      background-size: 100%;
      } */
      body, html {
      height: 100%;
      margin: 0;
      /* The image used */
      /* background-image: url("./img/troll.jpg"); */
      /* Full height */
      height: 100%;
      /* Center and scale the image nicely */
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      /* color: #71eeb8; */
      }
      nav {background-color: #71eeb8; border:none;font-family:'Open Sans', sans-serif;position:relative;}
      .navbar-header{padding-right:50px}
      .navbar-brand{color:#08442a}
      .navbar-brand:hover{color:#08442a;}
      .nav-item a{color:#08442a}
      .nav-item a:hover{text-decoration: none;color:white}
      .nav-item{margin-right:15px}

      .container{width:100%;}

      .middle{text-align:center;}
      input{margin-top:12px}

      form textarea{width:80%;resize:none;height:50px}
      form textarea:focus{outline:none}
      form button{position:absolute;width:inherit;height:50px}

      #coloring{display: inline-block;float: right;width: 30%;}

      /* The container
      <div>
      - needed to position the dropdown content */
      .dropdown {position: relative;display: inline-block;}
      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {display: none;position: absolute;background-color: white;box-shadow: 0px 8px 16px 2px rgba(0,0,0,0);z-index: 1;}
      /* Links inside the dropdown */
      .dropdown-content a {color: black;padding: 12px 16px;text-decoration: none;display: block;}
      /* Change color of dropdown links on hover */
      .dropdown-content a:hover {background-color: #ddd;}
      /* Show the dropdown menu on hover */
      .dropdown:hover .dropdown-content {display: block;}
      /* Change the background color of the dropdown button when the dropdown content is shown */
      .dropdown:hover .dropbtn {background-color: #17a2b8;}
      label{background-color: white;}
   </style>
</head>

<nav class="navbar navbar-toggleable-xs navbar-expand-md fixed-top">
   <div class="navbar-collapse collapse">
      <div class="navbar-header">
         <a class="navbar-brand" th:href="@{/home}"><span class="fa fa-book"></span> COMS</a>
      </div>
   </div>
</nav>

<body>
   <div class="container">
      <!-- TOP TOOLBAR -->
      <div class="btn-toolbar" role="toolbar" style="margin:0 auto">
         <!-- UNDO REDO GROUP UNGROUP =-->
         <div class="btn-group mr-2" role="group">
            <button type="button" class="btn btn-info" onclick="undo()">
               <img src="/img/undo.png" alt="Undo" height="20" width = "20">
            </button>
            <button type="button" class="btn btn-info" onclick="redo()">
               <img src="/img/redo.png" alt="Redo" height="20" width = "20">
            </button>
            <button type="button" class="btn btn-info" onclick="deleteObject()">
               <img src="/img/trash.png" alt="Delete" height="20" width = "20">
            </button>
            <button  type="button" class="btn btn-info" onclick="group()">
               <img src="/img/group.png" alt="Group" height="20" width = "20">
            </button>
            <button type="button" class="btn btn-info" onclick="ungroup()">
               <img src="/img/ungroup.png" alt="Ungroup" height="20" width = "20">
            </button>
         </div>

         <!-- COPY CUT PASTE -->
         <div class="btn-group mr-2" role="group">
            <button type="button" class="btn btn-info" onclick="copy()">
               <img src="/img/copy.png" alt="Copy" height="20" width = "20">
            </button>
            <button type="button" class="btn btn-info" onclick="cut()">
               <img src="/img/cut.png" alt="Cut" height="20" width = "20">
            </button>
            <button type="button" class="btn btn-info" onclick="paste()">
               <img src="/img/paste.png" alt="Paste" height="20" width = "20">
            </button>
         </div>

         <!-- ZOOMING BUTTONS -->
         <div class="btn-group mr-2" role="group">
            <button  type="button" class="btn btn-info" onclick="zoomin()">
               <img src="/img/zoom-in.png" alt="Zoom In" height="20" width = "20">
            </button>
            <button  type="button" class="btn btn-info" onclick="zoomout()">
               <img src="/img/zoom-out.png" alt="Zoom Out" height="20" width = "20">
            </button>
            <button  type="button" class="btn btn-info" onclick="recenter()">
               <img src="/img/center.png" alt="Center" height="20" width = "20">
            </button>
         </div>

         <!-- CLEAR SAVE EXPORT -->
         <div class="btn-group mr-2" role="group">
            <button id="clear-canvas" class="btn btn-info">
               <img src="/img/clear.png" alt="Clear" height="20" width = "20">
            </button>
            <button id="save-canvas" type="button" class="btn btn-info" >
               <img src="/img/save.png" alt="Save" height="20" width = "20">
            </button>
            <div class="dropdown">
               <button class="btn btn-info dropdown-toggle" type="button" id="exportButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <img src="/img/download.png" alt="shapes" height="20" width="20">
               </button>
               <div class="dropdown-menu" aria-labelledby="exportButton">
                  <button type="button" class="btn btn-info" onclick="downloadImage()">
                     <img src="/img/imagedownload.png" alt="Download as an Image" height="20" width = "20">
                  </button>
                  <button type="button" class="btn btn-info" onclick="downloadJSON()" >
                     <img src="/img/json.png" alt="Download as a JSON" height="15" width="20">
                  </button>
               </div>
            </div>
         </div>
      </div>

      <!-- SIDE TOOLBAR -->
      <div class="btn-group-vertical" style="float:left">
         <!-- SHAPES BUTTONS -->
         <div class="dropdown">
            <button class="btn btn-info dropdown-toggle" type="button" id="shapesButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               <img src="/img/shapes.png" alt="shapes" height="20" width="20">
            </button>
            <div class="dropdown-menu" aria-labelledby="shapesButton">
               <button type="button" class="btn btn-info" onclick="drawRec()" id="rect">
                  <img src="/img/rectangle.png" alt="Rectangle" height="20" width="30">
               </button>
               <button type="button" class="btn btn-info" onclick="drawSquare()">
                  <img src="/img/square.png" alt="Square" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="drawTriangle()">
                  <img src="/img/triangle.png" alt="Triangle" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="drawCircle()">
                  <img src="/img/ellipse.png" alt="Circle" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="drawLine()">
                  <img src="/img/line.png" alt="Line" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="arrow()">
                  <img src="/img/arrow.png" alt="Arrow" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="chat()">
                  <img src="/img/chat.png" alt="Talk Bubble" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="thought()">
                  <img src="/img/thought.png" alt="Thought Bubble" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="scream()">
                  <img src="/img/scream.png" alt="Scream Bubble" height="20" width = "20">
               </button>
               <button type="button" class="btn btn-info" onclick="action()">
                  <img src="/img/action.png" alt="Action Bubble" height="20" width = "20">
               </button>
            </div>
         </div>

         <!-- ADD TEXTBOX -->
         <button class="btn btn-info" onclick="addTextbox()">
            <img src="/img/text.png" alt="Text" height="20" width="20">
         </button>

         <!-- UPLOAD BUTTONS -->
         <div class="dropdown">
            <button class="btn btn-info dropdown-toggle" type="button" id="uploadButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               <img src="/img/image.png" alt="upload" height="20" width="20">
            </button>
            <div class="dropdown-menu" aria-labelledby="uploadButton">
               <button type="button" class="btn btn-info" onclick="document.getElementById('imgLoader').click();">
                  <img src="/img/imagedownload.png" alt="Upload Image" height="20" width = "20">
               </button>
               <input type='file' id="imgLoader" style="display: none;"/>
               <button type="button" class="btn btn-info" onclick="document.getElementById('jsonLoader').click();">
                  <img src="/img/json.png" alt="Upload Json" height="20" width = "20">
               </button>
               <input type='file' id="jsonLoader" style="display: none;"/>
            </div>
         </div>

         <!-- BACKGROUND BUTTONS -->
         <button type="button" class="btn btn-info" onclick="document.getElementById('backgroundImage').click();">
            <img src="/img/add.png" alt="Upload Download Image" height="20" width = "20">
         </button>
         <input type='file' id="backgroundImage" style="display: none;"/>
         <button type="button" class="btn btn-info" onclick="removeBackground()">
            <img src="/img/remove.png" alt="Remove Background" height="20" width = "20">
         </button>

         <!-- LAYER BUTTONS -->
         <button type="button" class="btn btn-info" onclick="sendToBack()" >
            <img src="/img/back.png" alt="Send To Back" height="15" width="20">
         </button>
         <button type="button" class="btn btn-info" onclick="back()" >
            <img src="/img/backward.png" alt="Send Back One" height="15" width="20">
         </button>
         <button type="button" class="btn btn-info" onclick="front()" >
            <img src="/img/forward.png" alt="Send Front One" height="15" width="20">
         </button>
         <button type="button" class="btn btn-info" onclick="bringToFront()">
            <img src="/img/front.png" alt="Send To Front" height="20" width = "20">
         </button>

      </div>

      <div class="middle">
         <div class="btn-group">
            <div id="mydiv" tabindex="0" />
               <canvas id="canvas" width="50%" height="400px" style="border:1px solid #000000;"></canvas>
         </div>
         <ul class="pagination" th:if="${panelList!=null}">
            <li class="page-item" th:each="panel,iter: ${panelList}">
               <a class="page-link" th:text="${iter.index+1}" th:data-thing="${panel.getId()}" onclick="form_edit_panel(this.getAttribute('data-thing'));"></a>
            </li>
            <li class="page-item">
               <a class="page-link" onclick="addPanelSubmit()">
                  Add Panel
               </a>
            </li>
         </ul>
      </div>

      <div class="right">
         <!-- TEXT FONT/SIZE -->
         <div class="dropdown-content">
            <label for="font">Font:</label><br>
            <select id="fonts" onchange="fontchange()">
               <option value="Arial">Arial</option>
               <option value="Helvetica">Helvetica</option>
               <option value="Times New Roman">Times New Roman</option>
               <option value="Times">Times</option>
               <option value="Impact">Impact</option>
               <option value="Courier New">Courier New</option>
               <option value="Courier">Courier</option>
               <option value="Verdana">Verdana</option>
               <option value="Georgia">Georgia</option>
               <option value="Palatino">Palatino</option>
               <option value="Garamond">Garamond</option>
               <option value="Bookman">Bookman</option>
               <option value="Comic Sans MS">Comic Sans MS</option>
               <option value="Trebuchet MS">Trebuchet MS</option>
               <option value="Arial Black">Arial Black</option>
            </select>
         </div>
         <label for="font">Font Size:</label><br>
         <input type="number"min="0" max="500" value="30" id="font-size">
      </div>

   <div class="middleTop">
      <div class="middleToold">
         <label for="stroke">Outline Color:</label>
         <input type="color" id="stroke" name="stroke" value="#000000" onchange="changeStroke()">

         <label for="fill">Fill Color:</label>
         <input type="color" id="fill" name="fill" value="#ffffff" onchange="changeFill()">
         <button type="button" class="btn btn-info" onclick="removeFill()"><img src="/img/empty.png" alt="Remove Fill" height="20" width = "20"></button>
         <br>
         <br>
      </div>
      <!-- <div id="pen"> -->
      <!-- <div id="drawing-mode-options"> -->
      <label for="drawing-mode-selector">Mode:</label>
      <select id="drawing-mode-selector">
         <option>Pencil</option>
         <option>Circle</option>
         <option>Spray</option>
         <option>Poka-dots</option>
         <option>hline</option>
         <option>vline</option>
         <option>square</option>
         <option>diamond</option>
      </select>
      <!-- <br> -->
      <label for="drawing-color">Line color:</label>
      <input type="color" value="#000000" id="drawing-color">
      <label for="drawing-line-width">Line width:</label>
      <input type="number" min="1" max="500" value="15" id="drawing-line-width">
      <!-- <span class="info">30</span><input type="range" value="30" min="0" max="150" id="drawing-line-width"><br> -->
      <label for="drawing-shadow-color">Shadow color:</label>
      <input type="color" value="#000000" id="drawing-shadow-color">
      <label for="drawing-shadow-width">Shadow width:</label>
      <input type="number" min="0" max="500" value="0" id="drawing-shadow-width">
      <label for="drawing-shadow-offset">Shadow offset:</label>
      <input type="number" min="0" max="500" size="4" value="30" id="drawing-shadow-offset">
      <button id="drawing-mode" class="btn btn-info">Exit drawing</button>
      <!-- </div> -->
      <!-- </div> -->
      <div id="coloring">
         <script>
            var sel = document.getElementById('fonts');
            console.log( sel.value );
            function fontchange(){
                console.log("value has been changed");
                var x = document.getElementById("fonts").value;
                console.log(x);
                console.log(typeof(x));
            }
         </script>
      </div>
   </div>


<!--          <form action = "/series/editComic" method = "post" id = "editPanelForm"> -->
     <form hidden action = "/comic/edit" method = "post" id = "editPanelForm">
         <input name = "editPanelId" id = "editPanelId">
      </form>
      <form id="addPanelForm" hidden action = "/addPanel", method = "GET">
         <button type="submit"></button>
      </form>
      <script src="/js/canvas-toBlob.js"></script>
      <script type="text/javascript" src = "/js/FileSaver.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.7.0/fabric.min.js"></script>
      <script type="text/javascript" src = "/js/canvasDrawing.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
          $(document).ready(function() {
              $("#save-canvas").click(function() {
                 console.log(canvas.toJSON());
                  console.log(canvas.toDataURL);
                  var requestBody = {
                      body: JSON.stringify(canvas.toJSON()),
                      image: canvas.toDataURL()
                  }
                  $.ajax({
                      type:'POST',
                      url :"/savePanel",
                      data: requestBody,
                      success: [function(data) {
                          console.log(data);
                          //$("body").html(data);
                     }],
                      error:function(exception){alert('Exeption:'+exception);}
                  });
              });
          });
         function form_edit_panel(panelId) {
             document.getElementById("editPanelId").value = panelId
             document.getElementById("editPanelForm").submit();
         }

         function addPanelSubmit(){
            document.getElementById("addPanelForm").submit();
         }
      </script>
      <script th:inline="javascript">
         /*<![CDATA[*/

         console.log(/*[[${currentPanel}]]*/ null);
         if(/*[[${currentPanel}]]*/ null != null)
         {
             var json = /*[[${currentPanel.getFabricJSON()}]]*/ null ;
             loading(json);
             // canvas.loadFromJSON(json, function() {
             //     canvas.renderAll();
             // },function(o,object){
             //     console.log(o,object)
             // })
         }


         /*]]>*/
      </script>
   </div>
</body>
</html>